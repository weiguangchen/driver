"use strict";const t=require("../../common/vendor.js"),i=require("../../uni_modules/uv-ui-tools/libs/mixin/mpMixin.js"),e=require("../../uni_modules/uv-ui-tools/libs/mixin/mixin.js"),s=require("../../uni_modules/uv-number-box/components/uv-number-box/props.js"),n={name:"uv-number-box",mixins:[i.mpMixin,e.mixin,s.props],props:{min:{default:0,type:Number},unit:{default:"吨",type:String},minLimitMsg:{default:null,type:Function},maxLimitMsg:{default:null,type:Function}},data:()=>({currentValue:"",longPressTimer:null}),watch:{watchChange(t){this.check()},value(t){t!==this.currentValue&&(this.currentValue=this.format(this.value))},modelValue(t){this.currentValue=this.formatter(this.format(this.modelValue))}},computed:{getCursorSpacing(){return this.$uv.getPx(this.cursorSpacing)},buttonStyle(){return t=>{const i={color:this.color};return this.isDisabled(t)&&(i.backgroundColor="#f7f8fa"),i}},inputStyle(){this.disabled||this.disabledInput;return{color:this.color}},watchChange(){return[this.integer,this.decimalLength,this.min,this.max]},isDisabled(){return t=>{const i=this.filter(this.currentValue),e=""===i?0:+i;return"plus"===t?this.disabled||this.disablePlus||e>=this.max:this.disabled||this.disableMinus||e<=this.min}}},created(){this.init()},methods:{init(){const t=this.value||this.modelValue;let i=this.format(t);this.currentValue=this.formatter(i)},format(i){if(i=""===(i=this.filter(i))?0:+i,console.log("max",this.max,"min",this.min,"value",i),t.Big(i||0).gt(this.max||0)){let i=`最大值为${this.max}`;this.maxLimitMsg&&"function"==typeof this.maxLimitMsg&&(i=this.maxLimitMsg(this.max)),t.index.showToast({title:i,icon:"none"})}if(t.Big(i||0).lt(this.min||0)){let i=`最小值为${this.min}`;this.minLimitMsg&&"function"==typeof this.minLimitMsg&&(i=this.minLimitMsg(this.min)),t.index.showToast({title:i,icon:"none"})}return i=Math.max(Math.min(this.max,i),this.min),null!==this.decimalLength&&(i=i.toFixed(this.decimalLength)),i},formatter:t=>t,filter(t){return t=String(t).replace(/[^0-9.-]/g,""),this.integer&&-1!==t.indexOf(".")&&(t=t.split(".")[0]),t},check(){const t=this.format(this.currentValue);t!==this.currentValue&&(this.currentValue=t)},onFocus(t){this.$emit("focus",{...t.detail,name:this.name})},onBlur(t){let i=this.format(t.detail.value);this.asyncChange||(console.log("onBlur",i),this.$nextTick((()=>{this.$emit("input",i),this.$emit("update:modelValue",i),this.currentValue=this.formatter(i),this.$forceUpdate()}))),this.$emit("blur",{...t.detail,name:this.name})},onInput(t){const{value:i=""}=t.detail||{};this.filter(i)},emitChange(t){this.asyncChange||this.$nextTick((()=>{this.$emit("input",t),this.$emit("update:modelValue",t),this.currentValue=this.formatter(t),this.$forceUpdate()})),this.$emit("change",{value:t,name:this.name})},onChange(){const{type:t}=this;if(this.isDisabled(t))return this.$emit("overlimit",t);const i="minus"===t?-this.step:+this.step,e=this.filter(this.currentValue);let s=this.format(this.add(+e,i));this.emitChange(s),this.$emit(t)},add(t,i){const e=Math.pow(10,10);return Math.round((t+i)*e)/e},clickHandler(t){this.type=t,this.onChange()},longPressStep(){this.clearTimeout(),this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),250)},onTouchStart(t){this.longPress&&(this.clearTimeout(),this.type=t,this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),600))},onTouchEnd(){this.longPress&&this.clearTimeout()},clearTimeout(){clearTimeout(this.longPressTimer),this.longPressTimer=null},clickUnit(){console.log(this.$refs.inputRef)}}};if(!Array){t.resolveComponent("uv-icon")()}Math;const o=t._export_sfc(n,[["render",function(i,e,s,n,o,l){return t.e({a:i.showMinus&&i.$slots.minus},i.showMinus&&i.$slots.minus?{b:t.o((t=>l.clickHandler("minus"))),c:t.o((t=>l.onTouchStart("minus"))),d:t.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t)))}:i.showMinus?{f:t.p({name:"minus",color:l.isDisabled("minus")?"#c8c9cc":"var(--title-color)",size:"15",bold:!0,customStyle:i.iconStyle}),g:t.o((t=>l.clickHandler("minus"))),h:t.o((t=>l.onTouchStart("minus"))),i:t.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t))),j:l.isDisabled("minus")?1:"",k:t.s(l.buttonStyle("minus"))}:{},{e:i.showMinus,l:i.disabledInput||i.disabled,m:l.getCursorSpacing,n:i.disabled||i.disabledInput?1:"",o:t.o(((...t)=>l.onBlur&&l.onBlur(...t))),p:t.o(((...t)=>l.onFocus&&l.onFocus(...t))),q:t.o([t=>o.currentValue=t.detail.value,(...t)=>l.onInput&&l.onInput(...t)]),r:t.s(l.inputStyle),s:o.currentValue,t:t.t(s.unit),v:i.showPlus&&i.$slots.plus},i.showPlus&&i.$slots.plus?{w:t.o((t=>l.clickHandler("plus"))),x:t.o((t=>l.onTouchStart("plus"))),y:t.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t)))}:i.showPlus?{A:t.p({name:"plus",color:l.isDisabled("plus")?"#c8c9cc":"var(--title-color)",size:"15",bold:!0,customStyle:i.iconStyle}),B:t.o((t=>l.clickHandler("plus"))),C:t.o((t=>l.onTouchStart("plus"))),D:t.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t))),E:l.isDisabled("plus")?1:"",F:t.s(l.buttonStyle("plus"))}:{},{z:i.showPlus})}],["__scopeId","data-v-ffb3817f"]]);wx.createComponent(o);
