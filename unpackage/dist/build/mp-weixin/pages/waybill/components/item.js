"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/index.js"),r=require("../../../utils/token.js"),o=require("../../../stores/location.js"),d=require("../../../utils/authorize.js");if(!Array){(e.resolveComponent("uv-image")+e.resolveComponent("my-plate")+e.resolveComponent("uv-line")+e.resolveComponent("uv-button")+e.resolveComponent("my-confirm"))()}Math||((()=>"../../../uni_modules/uv-image/components/uv-image/uv-image.js")+(()=>"../../../components/my-plate/my-plate.js")+(()=>"../../../uni_modules/uv-line/components/uv-line/uv-line.js")+(()=>"../../../uni_modules/uv-button/components/uv-button/uv-button.js")+(()=>"../../../components/my-confirm/my-confirm.js")+i)();const i=()=>"./UnloadModal.js",c={__name:"item",props:{record:{default:()=>{},type:Object}},emits:["success"],setup(i,{emit:c}){o.useLocationStore();const n=c,a=i,s=e.computed((()=>["0","1"].includes(a.record.WeightedStatus)?"待入厂":["2","3","4"].includes(a.record.WeightedStatus)?"已入厂":["5"].includes(a.record.WeightedStatus)?"装车中":["6"].includes(a.record.WeightedStatus)?"已装车":["7"].includes(a.record.WeightedStatus)?"已出厂":["8"].includes(a.record.WeightedStatus)?"已完成":["9"].includes(a.record.WeightedStatus)?"已取消":void 0)),u=e.ref();function l(){e.index.navigateTo({url:`/pages/wayBillDetail/wayBillDetail?onwayId=${a.record.OnwayId}&supplyId=${a.record.SupplyId}`})}function m(){u.value.confirm({title:"确认取消该笔运单？",content:"如取消次数过多，将会被限制接单",cancelText:"再想想",confirmText:"取消运单",asyncClose:!0,async confirm(){try{await t.DisableOnwayEnt({onwayId:a.record.Id,supplyId:a.record.SupplyId,userId:r.getToken().userInfo.Id,userType:"driver"}),await e.index.showToast({title:"操作成功",icon:"none",complete(){setTimeout((()=>{n("success")}),1500)}}),u.value.close()}catch(o){u.value.closeLoading(),e.index.showToast({title:o.data,icon:"none"})}}})}function S(){var t,r;e.index.makePhoneCall({phoneNumber:(null==(r=null==(t=a.record)?void 0:t.OwnerEnt)?void 0:r.LinkerMobile)??""})}function g(){var t,r;e.index.makePhoneCall({phoneNumber:(null==(r=null==(t=a.record)?void 0:t.SupEnt)?void 0:r.LinkerMobile)??""})}async function p(){e.index.showLoading({mask:!0});let r={};try{r=await d.getLocationInfo()}catch{return u.value.confirm({title:"定位失败",content:"请开启相关定位权限或者扫码入厂",showCancelButton:!1,confirmBgColor:"var(--main-color)"}),void e.index.hideLoading()}console.log("location",r);try{await t.ArrivedConfirm({onwayId:a.record.Id,supplyId:a.record.SupplyId,logitude:r.longitude,latitude:r.latitude}),e.index.hideLoading(),await e.index.showToast({title:"操作成功",icon:"none",complete(){setTimeout((()=>{n("success")}),1500)}})}catch(o){console.log("err",o),e.index.hideLoading(),e.index.showToast({title:o.data,icon:"none"})}}const h=e.ref();async function y(){h.value.open(a.record)}function f(){n("success")}return(t,r)=>e.e({a:e.t(s.value),b:["8","9"].includes(i.record.WeightedStatus)?1:"",c:["0","1","2","3","4","5","6","7"].includes(i.record.WeightedStatus)?1:"",d:"0"===i.record.WeightedStatus},"0"===i.record.WeightedStatus?e.e({e:!i.record.StartTime&&!i.record.EndTime||i.record.StartTime&&e.unref(e.dayjs)().isAfter(i.record.StartTime)&&!i.record.EndTime},!i.record.StartTime&&!i.record.EndTime||i.record.StartTime&&e.unref(e.dayjs)().isAfter(i.record.StartTime)&&!i.record.EndTime?{}:!i.record.EndTime&&i.record.StartTime&&e.unref(e.dayjs)().isBefore(i.record.StartTime)?{g:e.t(e.unref(e.dayjs)(i.record.StartTime).format("MM-DD HH:mm"))}:i.record.EndTime&&i.record.StartTime&&e.unref(e.dayjs)().isBefore(i.record.StartTime)?{i:e.t(e.unref(e.dayjs)(i.record.StartTime).format("MM-DD HH:mm")),j:e.t(e.unref(e.dayjs)(i.record.EndTime).format("MM-DD HH:mm"))}:i.record.StartTime&&e.unref(e.dayjs)().isAfter(i.record.StartTime)&&i.record.EndTime&&e.unref(e.dayjs)().isBefore(i.record.EndTime)||!i.record.StartTime&&i.record.EndTime&&e.unref(e.dayjs)().isBefore(i.record.EndTime)?{l:e.t(e.unref(e.dayjs)(i.record.EndTime).format("MM-DD HH:mm"))}:{},{f:!i.record.EndTime&&i.record.StartTime&&e.unref(e.dayjs)().isBefore(i.record.StartTime),h:i.record.EndTime&&i.record.StartTime&&e.unref(e.dayjs)().isBefore(i.record.StartTime),k:i.record.StartTime&&e.unref(e.dayjs)().isAfter(i.record.StartTime)&&i.record.EndTime&&e.unref(e.dayjs)().isBefore(i.record.EndTime)||!i.record.StartTime&&i.record.EndTime&&e.unref(e.dayjs)().isBefore(i.record.EndTime)}):{},{m:"1"===i.record.WeightedStatus},"1"===i.record.WeightedStatus?e.e({n:i.record.StatusCount&&i.record.StatusCount>1},i.record.StatusCount&&i.record.StatusCount>1?{o:e.t(i.record.StatusCount)}:{}):{},{p:"2"===i.record.WeightedStatus},(i.record.WeightedStatus,{}),{q:"3"===i.record.WeightedStatus},"3"===i.record.WeightedStatus?e.e({r:i.record.StatusCount&&i.record.StatusCount>1},i.record.StatusCount&&i.record.StatusCount>1?{s:e.t(i.record.StatusCount)}:{}):{},{t:"4"===i.record.WeightedStatus},(i.record.WeightedStatus,{}),{v:"5"===i.record.WeightedStatus},(i.record.WeightedStatus,{}),{w:"6"===i.record.WeightedStatus},(i.record.WeightedStatus,{}),{x:"7"===i.record.WeightedStatus},(i.record.WeightedStatus,{}),{y:"8"===i.record.WeightedStatus},"8"===i.record.WeightedStatus?{z:e.t(i.record.UserType?"driver"===i.record.UserType?"司机":"货主":"")}:{},{A:"9"===i.record.WeightedStatus},"9"===i.record.WeightedStatus?{B:e.t(i.record.UserType?"driver"===i.record.UserType?"司机":"货主":"")}:{},{C:e.t(i.record.OwnerEnt?i.record.OwnerEnt.OwnerName:""),D:i.record.SupEnt},i.record.SupEnt?{E:e.f(3,((e,t,r)=>({}))),F:e.p({src:"/static/images/dot1.png",width:"16rpx",height:"16rpx",duration:0,"custom-style":{marginRight:"16rpx"}}),G:e.t(i.record.SupEnt?i.record.SupEnt.City:""),H:e.t(i.record.SupEnt?i.record.SupEnt.Name:"")}:{},{I:i.record.UnloadEnt},i.record.UnloadEnt?{J:e.p({src:"/static/images/dot2.png",width:"16rpx",height:"16rpx",duration:0,"custom-style":{marginRight:"16rpx"}}),K:e.t(i.record.UnloadEnt?i.record.UnloadEnt.City:""),L:e.t(i.record.UnloadEnt?i.record.UnloadEnt.PlaceName:"")}:{},{M:i.record.Carno},i.record.Carno?{N:e.p({plate:i.record.Carno,color:i.record.CarColor})}:{},{O:e.t(i.record.MaterialName?i.record.MaterialName:""),P:e.p({direction:"col",color:"#B0BECC",length:"26rpx",margin:"0 20rpx 0 20rpx"}),Q:["0","1","2","3","4","5","9"].includes(i.record.WeightedStatus)},["0","1","2","3","4","5","9"].includes(i.record.WeightedStatus)?{R:e.t(i.record.EstimiteWeight)}:{},{S:["6","7","8"].includes(i.record.WeightedStatus)},["6","7","8"].includes(i.record.WeightedStatus)?{T:e.t(i.record.WeightEnt?i.record.WeightEnt.Suttle:"")}:{},{U:["0","1"].includes(i.record.WeightedStatus)},["0","1"].includes(i.record.WeightedStatus)?{V:e.o(m),W:e.p({shape:"circle",text:"取消运单",color:"var(--page-bg)",customTextStyle:{color:"var(--content-color)",fontSize:"26rpx"},customStyle:{height:"32px"}}),X:e.o((()=>{}))}:{},{Y:["0","1","7"].includes(i.record.WeightedStatus)},["0","1","7"].includes(i.record.WeightedStatus)?{Z:e.o(S),aa:e.p({shape:"circle",text:"呼叫货主",color:"var(--page-bg)",customTextStyle:{color:"var(--content-color)",fontSize:"26rpx"},customStyle:{height:"32px"}}),ab:e.o((()=>{}))}:{},{ac:["2","3","4","5","6"].includes(i.record.WeightedStatus)},["2","3","4","5","6"].includes(i.record.WeightedStatus)?{ad:e.o(g),ae:e.p({shape:"circle",text:"呼叫厂家",color:"var(--page-bg)",customTextStyle:{color:"var(--content-color)",fontSize:"26rpx"},customStyle:{height:"32px"}}),af:e.o((()=>{}))}:{},{ag:["0"].includes(i.record.WeightedStatus)},["0"].includes(i.record.WeightedStatus)?{ah:e.o(p),ai:e.p({shape:"circle",text:"确认到厂",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);",customTextStyle:{fontSize:"26rpx"},customStyle:{height:"32px"}}),aj:e.o((()=>{}))}:{},{ak:["4"].includes(i.record.WeightedStatus)},["4"].includes(i.record.WeightedStatus)?{al:e.p({shape:"circle",text:"开始装车",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);",customTextStyle:{fontSize:"26rpx"},customStyle:{height:"32px"}}),am:e.o((()=>{}))}:{},{an:["7"].includes(i.record.WeightedStatus)},["7"].includes(i.record.WeightedStatus)?{ao:e.o(y),ap:e.p({shape:"circle",text:"确认卸货",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);",customTextStyle:{fontSize:"26rpx"},customStyle:{height:"32px"}}),aq:e.o((()=>{}))}:{},{ar:["0","1","2","3","4","5","6","7"].includes(i.record.WeightedStatus)?1:"",as:e.o(l),at:e.sr(u,"e40de024-10",{k:"modal"}),av:e.sr(h,"e40de024-11",{k:"unload"}),aw:e.o(f)})}},n=e._export_sfc(c,[["__scopeId","data-v-e40de024"]]);wx.createComponent(n);
