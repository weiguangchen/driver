"use strict";const e=require("../../common/vendor.js"),o=require("../../api/index.js"),r=require("../../stores/user.js");if(!Array){(e.resolveComponent("uv-form-item")+e.resolveComponent("uv-form")+e.resolveComponent("uv-button")+e.resolveComponent("my-confirm"))()}Math||(n+(()=>"../../uni_modules/uv-form/components/uv-form-item/uv-form-item.js")+t+a+(()=>"../../uni_modules/uv-form/components/uv-form/uv-form.js")+(()=>"../../uni_modules/uv-button/components/uv-button/uv-button.js")+(()=>"../../components/my-confirm/my-confirm.js"))();const t=()=>"./components/SelectColor.js",a=()=>"./components/SelectCarType.js",n=()=>"./components/CarNumber.js",l={__name:"addCar",setup(t){const a=r.useUserStore();e.onMounted((()=>{e.getCurrentInstance().proxy.getOpenerEventChannel().on("setData",(function({data:o}){console.log("setData",o),o&&(l.value={Id:o.Id,Carno:o.Carno,Color:o.Color,Cartype:o.Cartype}),e.index.setNavigationBarTitle({title:o?"编辑车辆":"添加车辆"})}))}));const n=e.ref(null),l=e.ref({Id:"",Carno:"",Color:"",Cartype:""}),s=e.ref({Carno:[{validator:(e,o,r)=>{if(!o)return!1;const t=o.split(""),a=t.slice(0,7).every((e=>" "!==e)),n=t.slice(0,8).every((e=>" "!==e));return a||n},message:"请填写正确的车牌号"}],Color:{required:!0,message:"请选择颜色",trigger:["blur","change"]},Cartype:{required:!0,message:"请选择类型",trigger:["blur","change"]}}),i=e.ref(!1);function u(){m.value.confirm({title:"确定删除车辆？",content:"您的运单记录不会被影响",cancelText:"再想想",confirmText:"删除",asyncClose:!0,async confirm(){try{await o.DiabledDriverCar({id:l.value.Id}),await a.getCarList(),e.index.showToast({title:"车辆删除成功",success(){e.index.navigateBack()}})}catch{m.value.closeLoading()}}})}function c(){i.value=!0,e.index.showLoading({mask:!0}),n.value.validate().then((()=>o.UptOrNewDriverCar(l.value))).then((async()=>{await a.getCarList(),e.index.showToast({title:"车辆添加成功",success(){e.index.navigateBack()}})})).catch((e=>{console.log("err",e)})).finally((()=>{e.index.hideLoading(),i.value=!1}))}const m=e.ref();return(o,r)=>e.e({a:e.o((e=>l.value.Carno=e)),b:e.p({modelValue:l.value.Carno}),c:e.p({labelPosition:"top",label:"车牌号码",prop:"Carno"}),d:e.o((e=>l.value.Color=e)),e:e.p({modelValue:l.value.Color}),f:e.p({labelPosition:"left",label:"车牌颜色",prop:"Color",borderBottom:!0}),g:e.o((e=>l.value.Cartype=e)),h:e.p({modelValue:l.value.Cartype}),i:e.p({labelPosition:"left",label:"车辆类型",prop:"Cartype"}),j:e.sr(n,"3faefa2e-0",{k:"form"}),k:e.p({errorType:"toast",model:l.value,rules:s.value,"label-width":"140rpx"}),l:l.value.Id},l.value.Id?{m:e.o(u),n:e.p({text:"删除车辆",color:"#FFF0EE",customTextStyle:{fontSize:"30rpx",color:"var(--red-color)"},"custom-style":{borderRadius:"16rpx",height:"96rpx"}})}:{},{o:e.o(c),p:e.p({text:"确认添加",color:" linear-gradient( 270deg, #31CE57 0%, #07B130 100%)",loading:i.value,"custom-style":{borderRadius:"16rpx",height:"96rpx"},customTextStyle:{fontSize:"30rpx"}}),q:e.sr(m,"3faefa2e-9",{k:"modal"})})}};wx.createPage(l);
