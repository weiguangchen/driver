"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/app.js"),t=require("../../stores/user.js"),n=require("../../stores/location.js"),a=require("../../utils/authorize.js"),r=require("../../utils/token.js"),i=require("../../api/index.js");if(!Array){(e.resolveComponent("uv-status-bar")+e.resolveComponent("uv-icon")+e.resolveComponent("uv-button")+e.resolveComponent("my-plate")+e.resolveComponent("uv-image")+e.resolveComponent("uv-line")+e.resolveComponent("uv-load-more")+e.resolveComponent("my-empty")+e.resolveComponent("my-login-drawer")+e.resolveComponent("my-tabbar"))()}Math||((()=>"../../uni_modules/uv-status-bar/components/uv-status-bar/uv-status-bar.js")+(()=>"../../uni_modules/uv-icon/components/uv-icon/uv-icon.js")+(()=>"../../uni_modules/uv-button/components/uv-button/uv-button.js")+(()=>"../../components/my-plate/my-plate.js")+(()=>"../../uni_modules/uv-image/components/uv-image/uv-image.js")+(()=>"../../uni_modules/uv-line/components/uv-line/uv-line.js")+s+u+(()=>"../../uni_modules/uv-load-more/components/uv-load-more/uv-load-more.js")+(()=>"../../components/my-empty/my-empty.js")+(()=>"../../components/my-login-drawer/my-login-drawer.js")+(()=>"../../components/my-tabbar/my-tabbar.js"))();const s=()=>"./components/SelectCargo.js",u=()=>"./components/Item.js",c={__name:"index",setup(s){const u=o.useAppStore(),c=t.useUserStore(),l=n.useLocationStore(),{carList:p,defaultCar:m}=e.storeToRefs(c),g=e.computed((()=>{var e;const o=r.getToken();return(null==(e=null==o?void 0:o.userInfo)?void 0:e.Nickname)??"司机师傅"})),d=e.ref(!1);e.onLoad((async()=>{console.log("onLoad");try{await a.getLocationInfo(),console.log("locationStore",l)}catch{}d.value=!0,r.getToken()&&(console.log("onload handle"),await c.getCarList(),await S(),await f())})),e.onShow((async()=>{console.log("onShow"),u.switchTab(0),d.value?r.getToken()&&(console.log("onshow handle"),await c.getCarList(),await f()):console.log("onShow is not init")}));const v=e.ref(0);async function f(){const e=await i.GetDriverWayCount();v.value=e}function h(){e.index.navigateTo({url:"/pages/addCar/addCar"})}function x(){e.index.navigateTo({url:"/pages/carList/carList"})}function y(){e.index.navigateTo({url:"/pages/guide/guide"})}function w(){e.index.navigateTo({url:`/pages/webview/webview?src=${encodeURIComponent("https://mp.weixin.qq.com/s?__biz=MzkxOTcyODM5OA==&mid=2247483675&idx=1&sn=3f1378b5f85fe5ed6144eb9446f63a32&chksm=c19cf97af6eb706cee30883335ba2e11ab4ebd79c23dac68af13106c2b56e20eee02ddfe656c#rd")}`})}function b(o){if(r.getToken())switch(o){case"数据统计":e.index.navigateTo({url:"/pages/statistics/statistics"});break;case"操作指南":e.index.navigateTo({url:"/pages/guide/guide"});break;case"问题反馈":e.index.navigateTo({url:"/pages/feedback/feedback"})}else T()}const C=e.ref();function T(){C.value.open()}function k(){e.index.reLaunch({url:"/pages/index/index"})}const j=e.ref("0"),L=e.ref([]);async function S(){try{const e=(await i.GetDriverTakeTicketOwnerList({carno:m.value.Carno})).map((e=>({value:e.Id,label:e.Ownername})));L.value=[{value:"0",label:"全部货主"},...e]}catch{j.value="0",L.value=[{value:"0",label:"全部货主"}]}}function B(e){_()}e.watch(m,(async(e,o)=>{if(console.log("切换默认车辆时，获取当前默认车牌号下可接运单",e,o),e&&!o||e&&o&&e.Id!==o.Id){console.log("重新获取列表");try{j.value="0",L.value=[],await S()}catch{}_()}else console.log("不需重新获取")}),{immediate:!0});const q=e.ref(0),I=e.ref([]);async function _(){try{const e=await i.GetReceiveAssignList({ownerId:"0"===j.value?"":j.value,latitude:l.location?l.location.latitude:"",longitude:l.location?l.location.longitude:""});q.value=e.assignCnt,I.value=e.assignList}catch{}}return(o,t)=>e.e({a:e.t(g.value),b:v.value>0},v.value>0?{c:e.t(v.value),d:e.p({name:"arrow-right",size:"20rpx","custom-style":{marginLeft:"4rpx"},color:"#ffffff"})}:{},{e:!e.unref(r.getToken)()},e.unref(r.getToken)()?e.unref(p)&&0===e.unref(p).length?{i:e.o(h),j:e.p({shape:"circle",text:"添加车辆",icon:"plus",iconColor:"#ffffff",iconSize:"24rpx",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);","custom-style":{height:"72rpx",width:"268rpx"},customTextStyle:{fontSize:"28rpx"}})}:{k:e.p({plate:e.unref(m).Carno,color:e.unref(m).Color}),l:e.t(e.unref(m).Cartype),m:e.p({src:"/static/images/arrow2.png",duration:0,width:"18rpx",height:"18rpx","custom-style":{marginLeft:"4rpx"}}),n:e.o(x),o:"自卸车"===e.unref(m).Cartype?1:"",p:"半挂车"===e.unref(m).Cartype?1:"",q:"罐车"===e.unref(m).Cartype?1:""}:{f:e.o(T),g:e.p({shape:"circle",text:"请登录",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);","custom-style":{height:"72rpx",width:"268rpx"},customTextStyle:{fontSize:"28rpx"}})},{h:e.unref(p)&&0===e.unref(p).length,r:e.p({color:"var(--divider)"}),s:e.p({src:"/static/images/home/scan.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),t:e.p({src:"/static/images/home/statistics.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),v:e.o((e=>b("数据统计"))),w:e.p({src:"/static/images/home/guide.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),x:e.o(y),y:e.p({src:"/static/images/home/feedback.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),z:e.o((e=>b("问题反馈"))),A:e.p({width:"100%",height:"100%",duration:0,src:"/static/images/mine/banner.png"}),B:e.o(w),C:!e.unref(r.getToken)()},e.unref(r.getToken)()?e.e({E:e.t(q.value),F:e.o(B),G:e.o((e=>j.value=e)),H:e.p({options:L.value,modelValue:j.value}),I:I.value.length>0},I.value.length>0?{J:e.f(I.value,((o,t,n)=>({a:o.Id,b:"09b53fa2-14-"+n,c:e.p({record:o})}))),K:e.p({status:"nomore",color:"#B0BECC","line-color":"#B0BECC","font-size":"24rpx"})}:{L:e.p({height:"200px",text:"暂无可接运单"})}):{D:e.p({src:"/static/images/empty/index.png",width:"176rpx",height:"176rpx",duration:0})},{M:e.sr(C,"09b53fa2-17",{k:"loginDrawer"}),N:e.o(k)})}};wx.createPage(c);
