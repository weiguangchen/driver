"use strict";const e=require("../../common/vendor.js"),o=require("../../stores/app.js"),t=require("../../stores/user.js"),n=require("../../stores/location.js"),a=require("../../utils/authorize.js"),i=require("../../utils/token.js"),s=require("../../api/index.js");if(!Array){(e.resolveComponent("uv-status-bar")+e.resolveComponent("uv-icon")+e.resolveComponent("uv-button")+e.resolveComponent("my-plate")+e.resolveComponent("uv-image")+e.resolveComponent("uv-line")+e.resolveComponent("uv-load-more")+e.resolveComponent("my-empty")+e.resolveComponent("my-login-drawer")+e.resolveComponent("my-tabbar"))()}Math||((()=>"../../uni_modules/uv-status-bar/components/uv-status-bar/uv-status-bar.js")+(()=>"../../uni_modules/uv-icon/components/uv-icon/uv-icon.js")+(()=>"../../uni_modules/uv-button/components/uv-button/uv-button.js")+(()=>"../../components/my-plate/my-plate.js")+(()=>"../../uni_modules/uv-image/components/uv-image/uv-image.js")+(()=>"../../uni_modules/uv-line/components/uv-line/uv-line.js")+r+l+(()=>"../../uni_modules/uv-load-more/components/uv-load-more/uv-load-more.js")+(()=>"../../components/my-empty/my-empty.js")+(()=>"../../components/my-login-drawer/my-login-drawer.js")+(()=>"../../components/my-tabbar/my-tabbar.js"))();const r=()=>"./components/SelectCargo.js",l=()=>"./components/Item.js",c={__name:"index",setup(r){const l=o.useAppStore(),c=t.useUserStore(),u=n.useLocationStore(),{carList:p,defaultCar:d}=e.storeToRefs(c),m=e.computed((()=>c.userInfo.Nickname??"司机师傅")),g=e.ref(!1);e.onLoad((async()=>{if(console.log("onLoad"),g.value=!0,i.getToken()){console.log("onload handle");try{await a.getLocationInfo(),console.log("locationStore",u)}finally{await c.getCarList(),await S(),await v()}}})),e.onShow((async()=>{console.log("onShow"),l.switchTab(0),g.value?i.getToken()&&(console.log("onshow handle"),await c.getCarList(),await v()):console.log("onShow is not init")}));const f=e.ref(0);async function v(){const e=await s.GetDriverWayCount();f.value=e}function h(){e.index.navigateTo({url:"/pages/addCar/addCar"})}function x(){e.index.navigateTo({url:"/pages/carList/carList"})}function y(){e.index.openOfficialAccountArticle({url:"https://mp.weixin.qq.com/s/6Hqb9mbfT_Te9Tu4cD26DQ"})}function w(){e.index.openOfficialAccountArticle({url:"https://mp.weixin.qq.com/s?__biz=MzkxOTcyODM5OA==&mid=2247483675&idx=1&sn=3f1378b5f85fe5ed6144eb9446f63a32&chksm=c19cf97af6eb706cee30883335ba2e11ab4ebd79c23dac68af13106c2b56e20eee02ddfe656c#rd"})}function b(o){if(i.getToken())switch(o){case"扫码助手":!async function(){if(!d.value)return void e.index.showToast({title:"请先添加车辆",icon:"none"});let o={};try{const t=await e.index.scanCode();console.log(t),o=JSON.parse(t.result),console.log(o);const{htQRType:n}=o;if(!n)return void e.index.showToast({title:"无效二维码",icon:"none"})}catch(t){return console.log("无效二维码",t),void e.index.showToast({title:"无效二维码",icon:"none"})}try{e.index.showLoading({mask:!0});const t={scanParam:JSON.stringify({...o})};console.log(t),await s.ScanQR(t),console.log("允许扫码"),e.index.hideLoading();const{assignId:n,supplyId:a}=o;e.index.navigateTo({url:`/pages/billDetail/billDetail?assignId=${n}&supplyId=${a}`})}catch(t){e.index.hideLoading(),e.index.showToast({title:t.data,icon:"none"})}}();break;case"数据统计":return void e.index.showToast({title:"敬请期待",icon:"none"});case"操作指南":e.index.navigateTo({url:"/pages/guide/guide"})}else T()}const C=e.ref();function T(){C.value.open()}function L(){e.index.reLaunch({url:"/pages/index/index"})}const j=e.ref(""),k=e.ref([]);async function S(){try{const e=(await s.GetDriverTakeTicketOwnerList({carno:d.value.Carno?d.value.Carno.trim():""})).map((e=>({value:e.Id,label:e.Ownername})));k.value=[{value:"",label:"全部货主"},...e]}catch{j.value="",k.value=[{value:"",label:"全部货主"}]}}async function q(o){try{e.index.showLoading(),await _()}finally{e.index.hideLoading()}}e.watch(d,(async(e,o)=>{if(console.log("切换默认车辆时，获取当前默认车牌号下可接运单",e,o),e&&!o||e&&o&&e.Id!==o.Id){console.log("重新获取列表");try{j.value="",k.value=[],await S()}catch{}_()}else console.log("不需重新获取")}),{immediate:!0});const I=e.ref(0),B=e.ref([]);async function _(){try{const e=await s.GetReceiveAssignList({ownerId:j.value,latitude:u.location?u.location.latitude:"",longitude:u.location?u.location.longitude:""});I.value=e.assignCnt,B.value=e.assignList}catch{}}return(o,t)=>e.e({a:e.t(m.value),b:f.value>0},f.value>0?{c:e.t(f.value),d:e.p({name:"arrow-right",size:"20rpx","custom-style":{marginLeft:"4rpx"},color:"#ffffff"})}:{},{e:!e.unref(i.getToken)()},e.unref(i.getToken)()?e.unref(p)&&0===e.unref(p).length?{i:e.o(h),j:e.p({shape:"circle",text:"添加车辆",icon:"plus",iconColor:"#ffffff",iconSize:"24rpx",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);","custom-style":{height:"72rpx",width:"268rpx"},customTextStyle:{fontSize:"28rpx"}})}:e.e({k:e.unref(d)},e.unref(d)?{l:e.p({plate:e.unref(d).Carno,color:e.unref(d).Color})}:{},{m:e.t(e.unref(d).Cartype),n:e.p({src:"/static/images/arrow2.png",duration:0,width:"18rpx",height:"18rpx","custom-style":{marginLeft:"4rpx"}}),o:e.o(x),p:"自卸车"===e.unref(d).Cartype?1:"",q:"半挂车"===e.unref(d).Cartype?1:"",r:"罐车"===e.unref(d).Cartype?1:""}):{f:e.o(T),g:e.p({shape:"circle",text:"请登录",color:"linear-gradient( 270deg, #31CE57 0%, #07B130 100%);","custom-style":{height:"72rpx",width:"268rpx"},customTextStyle:{fontSize:"28rpx"}})},{h:e.unref(p)&&0===e.unref(p).length,s:e.p({color:"var(--divider)"}),t:e.p({src:"/static/images/home/scan.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),v:e.o((e=>b("扫码助手"))),w:e.p({src:"/static/images/home/statistics.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),x:e.o((e=>b("数据统计"))),y:e.p({src:"/static/images/home/guide.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),z:e.o(y),A:e.p({src:"/static/images/home/feedback.png",width:"80rpx",height:"80rpx",duration:0,"custom-style":{marginBottom:"14rpx"}}),B:e.p({width:"100%",height:"100%",duration:0,src:"/static/images/mine/banner.png"}),C:e.o(w),D:!e.unref(i.getToken)()},e.unref(i.getToken)()?e.e({F:e.t(I.value),G:e.o(q),H:e.o((e=>j.value=e)),I:e.p({options:k.value,modelValue:j.value}),J:B.value.length>0},B.value.length>0?{K:e.f(B.value,((o,t,n)=>({a:o.Id,b:"09b53fa2-14-"+n,c:e.p({record:o})}))),L:e.p({status:"nomore",color:"#B0BECC","line-color":"#B0BECC","font-size":"24rpx"})}:{M:e.p({height:"200px",text:"暂无可接运单"})}):{E:e.p({src:"/static/images/empty/index.png",width:"176rpx",height:"176rpx",duration:0})},{N:e.sr(C,"09b53fa2-17",{k:"loginDrawer"}),O:e.o(L)})}};wx.createPage(c);
