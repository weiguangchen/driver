"use strict";const e=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),t=require("../../../uv-ui-tools/libs/mixin/mixin.js"),i=require("./props.js"),s=require("./valid.js"),r=require("../../../../common/vendor.js");s.Schema.warning=function(){};const n={name:"uv-form",mixins:[e.mpMixin,t.mixin,i.props],provide(){return{uForm:this}},data:()=>({formRules:{},validator:{},originalModel:null}),watch:{rules:{immediate:!0,handler(e){this.setRules(e)}},propsChange(e){var t;(null==(t=this.children)?void 0:t.length)&&this.children.map((e=>{"function"==typeof e.updateParentData&&e.updateParentData()}))},model:{immediate:!0,handler(e){this.originalModel||(this.originalModel=this.$uv.deepClone(e))}}},computed:{propsChange(){return[this.errorType,this.borderBottom,this.labelPosition,this.labelWidth,this.labelAlign,this.labelStyle]}},created(){this.children=[]},methods:{setRules(e){0!==Object.keys(e).length&&(this.formRules=e,this.validator=new s.Schema(e))},resetFields(){this.resetModel()},resetModel(e){this.children.map((e=>{const t=null==e?void 0:e.prop,i=this.$uv.getProperty(this.originalModel,t);this.$uv.setProperty(this.model,t,i)}))},clearValidate(e){e=[].concat(e),this.children.map((t=>{(void 0===e[0]||e.includes(t.prop))&&(t.message=null)}))},async validateField(e,t,i=null){this.$nextTick((()=>{const r=[];e=[].concat(e),this.children.map((t=>{const n=[];if(e.includes(t.prop)){const e=this.$uv.getProperty(this.model,t.prop),o=t.prop.split("."),l=o[o.length-1],a=this.formRules[t.prop];if(!a)return;const h=[].concat(a);for(let d=0;d<h.length;d++){const o=h[d],a=[].concat(null==o?void 0:o.trigger);if(i&&!a.includes(i))continue;new s.Schema({[l]:o}).validate({[l]:e},((e,i)=>{this.$uv.test.array(e)&&(r.push(...e),n.push(...e)),this.$nextTick((()=>{var e,i;t.message=(null==(e=n[0])?void 0:e.message)?null==(i=n[0])?void 0:i.message:null}))}))}}})),"function"==typeof t&&t(r)}))},validate(e){return new Promise(((e,t)=>{this.$nextTick((()=>{const i=this.children.map((e=>e.prop));this.validateField(i,(i=>{i.length?("toast"===this.errorType&&this.$uv.toast(i[0].message),t(i)):e(!0)}))}))}))}}};const o=r._export_sfc(n,[["render",function(e,t,i,s,r,n){return{}}]]);wx.createComponent(o);
